<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> icejs-todos-miniprogram · f00bar</title><meta name="description" content="icejs-todos-miniprogram - lancezhu"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://lancezhu.github.io/atom.xml" title="f00bar"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="f00bar" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="https://f00bar.cn" target="_blank" class="nav-list-link">BLOG2</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/LanceZhu" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#如何同时开发小程序-中后台应用-feat-icejs-小程序篇"><span class="toc-number">1.</span> <span class="toc-text">如何同时开发小程序+中后台应用(feat: icejs) - 小程序篇</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#介绍"><span class="toc-number">1.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小程序"><span class="toc-number">1.2.</span> <span class="toc-text">小程序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#项目初始化"><span class="toc-number">1.2.1.</span> <span class="toc-text">项目初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#页面编写"><span class="toc-number">1.2.2.</span> <span class="toc-text">页面编写</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Todos-列表页"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">Todos 列表页</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#添加-Todo-页"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">添加 Todo 页</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#项目配置"><span class="toc-number">1.2.3.</span> <span class="toc-text">项目配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据请求"><span class="toc-number">1.2.4.</span> <span class="toc-text">数据请求</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#以获取某用户的-Todos-为例"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">以获取某用户的 Todos 为例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据存储"><span class="toc-number">1.2.5.</span> <span class="toc-text">数据存储</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#小结"><span class="toc-number">1.2.6.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#推荐阅读"><span class="toc-number">1.3.</span> <span class="toc-text">推荐阅读</span></a></li></ol></li></ol><div class="post"><article class="post-block"><h1 class="post-title">icejs-todos-miniprogram</h1><div class="post-info">Oct 12, 2020</div><div class="post-content"><h1 id="如何同时开发小程序-中后台应用-feat-icejs-小程序篇"><a href="#如何同时开发小程序-中后台应用-feat-icejs-小程序篇" class="headerlink" title="如何同时开发小程序+中后台应用(feat: icejs) - 小程序篇"></a>如何同时开发小程序+中后台应用(feat: icejs) - 小程序篇</h1><blockquote>
<p>知乎：<a href="https://zhuanlan.zhihu.com/p/216507810" target="_blank" rel="noopener">使用 React + icejs 开发一个完整的 Todo 应用 - 小程序篇</a><br>语雀：<a href="https://www.yuque.com/f00bar/bsa44q/gfw19c" target="_blank" rel="noopener">如何同时开发小程序+中后台应用(feat: icejs) - 小程序篇</a></p>
</blockquote>
<blockquote>
<p><a href="https://ice.work/" target="_blank" rel="noopener">icejs</a> 主要应用场景为开发中后台应用。但 <a href="mailto:icejs@1.7.0">icejs@1.7.0</a> 版本开始支持<a href="https://ice.work/docs/miniprogram/start" target="_blank" rel="noopener">小程序开发</a>。如果你想使用 React 同时开发中后台应用和小程序，那么 icejs 即可满足你。使用同一套技术体系，减少技术切换成本，提高研发效率。</p>
</blockquote>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>本文将演示如何使用 icejs 构建 Todo 小程序 + 后台管理系统，同时包括相应服务端。</p>
<p>Todo 应用的功能或需求为：</p>
<ul>
<li>小程序端：展示 Todo 列表，支持增删改查，以及同步数据到服务端。</li>
<li>后台管理系统：小程序用户信息和增删改查的管理系统。</li>
</ul>
<p>整体的技术栈设计如下：</p>
<ul>
<li>*<em>小程序 *</em><ul>
<li>icejs 框架</li>
<li>universal-request 数据请求</li>
</ul>
</li>
<li><strong>后台管理系统</strong><ul>
<li>icejs 框架</li>
<li>icejs build-plugin-ice-auth 插件，权限管理</li>
<li>fusion design UI 组件库</li>
</ul>
</li>
<li><strong>服务端</strong> + <strong>数据库</strong><ul>
<li>eggjs 服务端框架</li>
<li>egg-sequelize + mysql2 用于 eggjs 连接 MySQL 数据库</li>
<li>MySQL 数据库</li>
<li>uuid 唯一 id 生成</li>
</ul>
</li>
</ul>
<p>因篇幅较长，如何同时开发小程序+中后台应用（feat: icejs）将分为三篇分别介绍。</p>
<ul>
<li>小程序篇（本文）</li>
</ul>
<p>使用 icejs 开发 Todo 小程序。</p>
<ul>
<li>后台管理系统篇</li>
</ul>
<p>使用 icejs 开发 Todo 小程序后台管理系统。</p>
<ul>
<li>服务端篇</li>
</ul>
<p>搭建服务 Todo 小程序及后台管理系统的服务端。</p>
<h2 id="小程序"><a href="#小程序" class="headerlink" title="小程序"></a>小程序</h2><blockquote>
<p>项目代码见：<a href="https://github.com/ice-lab/miniprogram-materials/tree/master/scaffolds/todos" target="_blank" rel="noopener">miniprogram-materials/scaffolds/todos</a><br>小程序开发基于icejs，详细内容见 <a href="https://github.com/ice-lab/miniprogram-materials/tree/master/scaffolds/todos" target="_blank" rel="noopener">icejs 小程序开发文档</a></p>
</blockquote>
<h3 id="项目初始化"><a href="#项目初始化" class="headerlink" title="项目初始化"></a>项目初始化</h3><p>创建文件夹存放代码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir todos &amp;&amp; <span class="built_in">cd</span> todos</span><br></pre></td></tr></table></figure>


<p>基于 icejs 小程序 JavaScript 模板初始化项目</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm init ice . <span class="comment"># 在当前目录下初始项目</span></span><br></pre></td></tr></table></figure>


<p>选择 JavaScript 小程序模板即 Lightweight JavaScript template with miniapp Program</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/2070295/1598521001177-8b125520-f5d4-46f2-a6f8-598e2150ffed.png#align=left&display=inline&height=192&margin=%5Bobject%20Object%5D&originHeight=192&originWidth=471&status=done&style=none&width=471" alt=""></p>
<p>启动项目</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ npm install &amp;&amp; npm run start</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从微信开发者工具中导入构建完成后的产物可以看到项目正常运行</span></span><br><span class="line"><span class="comment"># 构建产物位置位于 ./build 目录中。./build/miniapp 为支付宝小程序；./build/wechat-miniprogram 为微信小程序</span></span><br></pre></td></tr></table></figure>


<blockquote>
<p><a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/devtools.html" target="_blank" rel="noopener">微信开发者工具下载</a><br><a href="https://render.alipay.com/p/f/fd-jwq8nu2a/pages/home/index.html" target="_blank" rel="noopener">支付宝小程序开发工具下载</a></p>
</blockquote>
<p>使用微信开发者工具管理小程序<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2070295/1598931377928-a0bf4ffa-3dad-4bc7-81c7-18b5d0d8d087.png#align=left&display=inline&height=344&margin=%5Bobject%20Object%5D&name=image.png&originHeight=688&originWidth=1016&size=108179&status=done&style=none&width=508" alt="image.png"><br>导入构建的小程序包</p>
<blockquote>
<p>此处 AppID 应填写自己所申请的小程序 AppID 或使用 测试号</p>
</blockquote>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/2070295/1598931459380-01eb51a3-e13f-436b-9ff9-a7fe90111b59.png#align=left&display=inline&height=345&margin=%5Bobject%20Object%5D&name=image.png&originHeight=689&originWidth=1015&size=45416&status=done&style=none&width=507.5" alt="image.png"><br>开发者工具中小程序编译成功<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2070295/1598931572145-a4d6e362-5612-4fcb-87c9-b324ee4db9cb.png#align=left&display=inline&height=511&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1022&originWidth=1916&size=170663&status=done&style=none&width=958" alt="image.png"><br>项目目录结构为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── .ice&#x2F;                          # 运行时生成的临时目录</span><br><span class="line">├── build&#x2F;                         # 构建产物目录</span><br><span class="line">├── src&#x2F;                           # 源码目录</span><br><span class="line">│    ├── components                # 应用的公共组件</span><br><span class="line">│    │     └── Logo             </span><br><span class="line">│    │       ├── index.module.less # Logo 组件的样式文件</span><br><span class="line">│    │       └── index.jsx         # Logo 组件 JSX 源码           </span><br><span class="line">│    └── pages                     # 页面</span><br><span class="line">│    │     └── Home                # home 页面</span><br><span class="line">│    │         └── index.jsx</span><br><span class="line">│    ├── app.js                    # 应用入口文件</span><br><span class="line">│    └── app.json                  # 应用配置，包括路由配置，小程序 window 配置等</span><br><span class="line">├── README.md                      # 项目说明</span><br><span class="line">├── build.json                     # 项目构建配置</span><br><span class="line">├── package.json</span><br><span class="line">└── tsconfig.json</span><br></pre></td></tr></table></figure>


<h3 id="页面编写"><a href="#页面编写" class="headerlink" title="页面编写"></a>页面编写</h3><p>页面编写与使用 React 开发基本一致。</p>
<p>对于小程序中的生命周期函数，可使用 <code>usePageShow</code>、<code>usePageHide</code> 或者 <code>withPageLifeCycle</code> 等方法进行监听。详细文档见<a href="">页面配置#生命周期</a>。</p>
<h4 id="Todos-列表页"><a href="#Todos-列表页" class="headerlink" title="Todos 列表页"></a>Todos 列表页</h4><p><strong>创建 src/pages/todos 编写 UI</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; usePageShow &#125; <span class="keyword">from</span> <span class="string">'ice'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> AddButton <span class="keyword">from</span> <span class="string">'@/components/add-button'</span>; <span class="comment">// 组件：添加新 Todo按钮</span></span><br><span class="line"><span class="keyword">import</span> logo <span class="keyword">from</span> <span class="string">'@/public/logo.svg'</span>;</span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">'./index.module.scss'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Todos = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// state</span></span><br><span class="line">  <span class="keyword">const</span> [userInfo, setUserInfo] = useState(&#123;&#125;);</span><br><span class="line">  <span class="keyword">const</span> [todos, setTodos] = useState([]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// handlers</span></span><br><span class="line">  <span class="keyword">const</span> onTodoChange = <span class="keyword">async</span> id =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> changedContent = &#123;&#125;;</span><br><span class="line">    <span class="keyword">const</span> changedTodos = todos.map(<span class="function"><span class="params">todo</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="attr">id</span>: curId &#125; = todo;</span><br><span class="line">      <span class="keyword">const</span> &#123; completed &#125; = todo.content;</span><br><span class="line">      <span class="keyword">if</span> (id === curId) &#123;</span><br><span class="line">        changedContent = &#123;</span><br><span class="line">          ...todo.content,</span><br><span class="line">          completed: id === curId ? !completed : completed</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...todo,</span><br><span class="line">        content: &#123;</span><br><span class="line">          ...todo.content,</span><br><span class="line">          completed: id === curId ? !completed : completed</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    setTodos(changedTodos);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// lifecycle function</span></span><br><span class="line">  usePageShow(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> defaultTodos = [</span><br><span class="line">      &#123;</span><br><span class="line">        content: &#123; <span class="attr">text</span>: <span class="string">'Learning Javascript'</span>, <span class="attr">completed</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">        id: <span class="number">0</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        content: &#123; <span class="attr">text</span>: <span class="string">'Learning ES2016'</span>, <span class="attr">completed</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">        id: <span class="number">1</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        content: &#123; <span class="attr">text</span>: <span class="string">'Learning 小程序'</span>, <span class="attr">completed</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">        id: <span class="number">2</span></span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 暂时使用默认 Todos 测试 UI</span></span><br><span class="line">    setTodos(defaultTodos);</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=&#123;styles[<span class="string">'page-todos'</span>]&#125;&gt;</span><br><span class="line">      &lt;div className=&#123;styles.user&#125;&gt;</span><br><span class="line">        &lt;button type=<span class="string">'button'</span> className=&#123;styles[<span class="string">'login-button'</span>]&#125; &gt;</span><br><span class="line">          &lt;div style=&#123;&#123;<span class="attr">display</span>: <span class="string">'flex'</span>, <span class="attr">flexDirection</span>: <span class="string">'column'</span>&#125;&#125;&gt;</span><br><span class="line">            &lt;img className=&#123;styles.avatar&#125; src=&#123;userInfo.avatarUrl ? userInfo.avatarUrl : logo&#125; alt=<span class="string">"用户头像"</span> /&gt;</span><br><span class="line">            &lt;span className=&#123;styles.nickname&#125;&gt;&#123;userInfo.nickName ? <span class="string">`<span class="subst">$&#123;userInfo.nickName&#125;</span>'s`</span> : <span class="string">'My'</span> &#125; Todo List&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>div&gt;</span><br><span class="line">        &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;div className=&#123;styles[<span class="string">'todo-items'</span>]&#125;&gt;</span><br><span class="line">        &lt;div className=&#123;styles[<span class="string">'todo-items-group'</span>]&#125;&gt;</span><br><span class="line">          &#123;</span><br><span class="line">            todos.map(<span class="function"><span class="params">todo</span> =&gt;</span> (</span><br><span class="line">              &lt;div style=&#123;&#123;<span class="attr">position</span>: <span class="string">'relative'</span>&#125;&#125; key=&#123;todo.id&#125;&gt;</span><br><span class="line">                &lt;div</span><br><span class="line">                  className=&#123;<span class="string">`<span class="subst">$&#123;styles[<span class="string">'todo-item'</span>]&#125;</span> <span class="subst">$&#123;todo.content.completed ? styles.checked : <span class="string">''</span>&#125;</span>`</span>&#125;</span><br><span class="line">                  onClick=&#123;() =&gt; onTodoChange(todo.id)&#125;</span><br><span class="line">                &gt;</span><br><span class="line">                  &lt;checkbox className=&#123;styles[<span class="string">'todo-item-checkbox'</span>]&#125; checked=&#123;todo.content.completed&#125; /&gt;</span><br><span class="line">                  &lt;span className=&#123;styles[<span class="string">'todo-item-text'</span>]&#125;&gt;&#123;todo.content.text&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">                &lt;/</span>div&gt;</span><br><span class="line">                &lt;div</span><br><span class="line">                  className=&#123;styles[<span class="string">'close-wrapper'</span>]&#125;</span><br><span class="line">                  &gt;</span><br><span class="line">                  &lt;div className=&#123;styles.close&#125;/&gt;</span><br><span class="line">                &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">              &lt;/</span>div&gt;</span><br><span class="line">            ))</span><br><span class="line">          &#125;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div className=&#123;styles[<span class="string">'todo-footer'</span>]&#125;&gt;</span><br><span class="line">        &lt;AddButton text=<span class="string">"Add Todo"</span> /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Todos;</span><br></pre></td></tr></table></figure>
<p><strong>添加样式</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line">// src/pages/todos/index.module.scss</span><br><span class="line"><span class="selector-tag">page</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#323239</span>;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">"pingFang SC"</span> <span class="string">"pingFang"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#323239</span>;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">"pingFang SC"</span> <span class="string">"pingFang"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.page-todos</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">"pingFang SC"</span> <span class="string">"pingFang"</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">750</span>rpx;</span><br><span class="line">  <span class="attribute">max-height</span>: <span class="number">100vh</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.user</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-shrink</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#FFF</span>;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.login-button</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">background</span>: none;</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">  <span class="attribute">width</span>: auto;</span><br><span class="line">  <span class="attribute">height</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.login-button</span><span class="selector-pseudo">:after</span>&#123;</span><br><span class="line">  <span class="attribute">content</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.avatar</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">130</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">130</span>rpx;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#FFF</span>;</span><br><span class="line">  <span class="attribute">align-self</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nickname</span> &#123;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">100</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#FFF</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.todo-items</span> &#123;</span><br><span class="line">  <span class="attribute">flex-grow</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">34</span>rpx;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">120</span>rpx;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#0EFFD6</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.todo-items-group</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.todo-item</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">50</span>rpx;</span><br><span class="line">  <span class="attribute">padding-left</span>:<span class="number">80</span>rpx;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">70</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">80</span>rpx;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">2px</span> solid <span class="built_in">rgb</span>(14, 255, 214);</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">100</span>rpx;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">  <span class="comment">/* white-space:nowrap; */</span></span><br><span class="line"></span><br><span class="line">  <span class="attribute">transition</span>: border <span class="number">0.2s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.todo-item</span><span class="selector-pseudo">:last-child</span> &#123;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.todo-item</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">''</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">12</span>rpx;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">45</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">45</span>rpx;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(14, 222, 255, 0.3);</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateY</span>(-50%);</span><br><span class="line"></span><br><span class="line">  <span class="attribute">transition</span>: background-color <span class="number">0.2s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.todo-item</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">''</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">29</span>rpx;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">8</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">18</span>rpx;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateY</span>(-60%) <span class="built_in">rotate</span>(38deg);</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">4</span>rpx solid <span class="number">#FFF</span>;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="number">0</span> <span class="number">4</span>rpx <span class="number">4</span>rpx <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">transition</span>: opacity <span class="number">0.2s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.todo-item-checkbox</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checked</span> <span class="selector-class">.todo-item-text</span> &#123;</span><br><span class="line">  <span class="attribute">text-decoration</span>: line-through;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#1AA0B8</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checked</span><span class="selector-class">.todo-item</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">2px</span> solid <span class="built_in">rgba</span>(14, 222, 255, 0.2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checked</span><span class="selector-class">.todo-item</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(14, 222, 255, 0.2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.checked</span><span class="selector-class">.todo-item</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.todo-item-operation</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">background</span>: none;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#FFF</span>;</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.todo-item-operation</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.close-wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">80</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">80</span>rpx;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">20</span>rpx;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">20</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.close</span> &#123;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(14, 222, 255, 0.3);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.close</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">' '</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#2c2c2c</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">8</span>rpx;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">30</span>rpx;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(-50%, -50%) <span class="built_in">rotate</span>(45deg);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.close</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">' '</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#2c2c2c</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">8</span>rpx;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">30</span>rpx;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">4</span>rpx;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(-50%, -50%) <span class="built_in">rotate</span>(-45deg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.todo-footer</span> &#123;</span><br><span class="line">  <span class="attribute">flex-shrink</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">50</span>rpx <span class="number">0</span> <span class="number">100</span>rpx;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">48</span>rpx;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">200</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>编写所需组件 add-button</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/components/add-button/index.jsx</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">'./index.module.scss'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AddButton</span> (<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; text, onClickMe &#125; = props;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;button type=<span class="string">'button'</span> className=&#123;styles[<span class="string">'add-button'</span>]&#125; onClick=&#123;onClickMe&#125;&gt;</span><br><span class="line">      &lt;span className=&#123;styles[<span class="string">'add-icon'</span>]&#125;&gt;+<span class="xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">      &lt;span&gt;&#123;text&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>button&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> AddButton;</span><br></pre></td></tr></table></figure>
<p><strong>为组件添加样式</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/components/add-button/index.module.scss</span></span><br><span class="line">.add-button &#123;</span><br><span class="line">  display: inline-block;</span><br><span class="line">  background: none;</span><br><span class="line">  color: #FFF;</span><br><span class="line">  border: none;</span><br><span class="line">  width: <span class="number">300</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.add-button:after &#123;</span><br><span class="line">  content: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.add-icon &#123;</span><br><span class="line">  font-size: <span class="number">52</span>rpx;</span><br><span class="line">  color: #00FFD6;</span><br><span class="line">  margin-right: <span class="number">10</span>rpx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>添加 logo 图片</strong><br>src/public/logo.svg</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg xmlns=<span class="string">"http://www.w3.org/2000/svg"</span> viewBox=<span class="string">"-11.5 -10.23174 23 20.46348"</span>&gt;</span><br><span class="line">  &lt;title&gt;React Logo&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">  &lt;circle cx="0" cy="0" r="2.05" fill="#61dafb"/</span>&gt;</span><br><span class="line">  &lt;g stroke=<span class="string">"#61dafb"</span> stroke-width=<span class="string">"1"</span> fill=<span class="string">"none"</span>&gt;</span><br><span class="line">    &lt;ellipse rx=<span class="string">"11"</span> ry=<span class="string">"4.2"</span>/&gt;</span><br><span class="line">    &lt;ellipse rx=<span class="string">"11"</span> ry=<span class="string">"4.2"</span> transform=<span class="string">"rotate(60)"</span>/&gt;</span><br><span class="line">    &lt;ellipse rx=<span class="string">"11"</span> ry=<span class="string">"4.2"</span> transform=<span class="string">"rotate(120)"</span>/&gt;</span><br><span class="line">  &lt;<span class="regexp">/g&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>svg&gt;</span><br></pre></td></tr></table></figure>
<p><strong>添加路由</strong><br>编辑 src/app.json</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"routes"</span>: [ // 页面路由数组</span><br><span class="line">    &#123;</span><br><span class="line">      "path": "/todos",  // /todos 路由</span><br><span class="line">      "source": "pages/todos/index" // 实际 React 组件，即上面所写组件</span><br><span class="line">    &#125;,</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>构建小程序</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ npm run start <span class="comment"># 构建小程序</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将构建产物 ./build/wechat-miniprogram 导入至微信开发者工具中</span></span><br></pre></td></tr></table></figure>
<p>小程序开发者工具进行编译，实际效果为：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2070295/1598962296957-1a3b3424-96af-4052-9b78-65457af2956b.png#align=left&display=inline&height=710&margin=%5Bobject%20Object%5D&name=image.png&originHeight=710&originWidth=399&size=45216&status=done&style=none&width=399" alt="image.png"><br>切换 Todo 完成状态<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2070295/1598962311241-f7112c35-8ea1-4ff4-b89c-add990a04713.png#align=left&display=inline&height=709&margin=%5Bobject%20Object%5D&name=image.png&originHeight=709&originWidth=400&size=45554&status=done&style=none&width=400" alt="image.png"><br>Todos 列表页面样式完成。可切换 Todo 完成情况。</p>
<h4 id="添加-Todo-页"><a href="#添加-Todo-页" class="headerlink" title="添加 Todo 页"></a>添加 Todo 页</h4><p><strong>编写 UI</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/pages/add-todo/index.jsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> AddButton <span class="keyword">from</span> <span class="string">'@/components/add-button'</span>;</span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">'./index.module.scss'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> AddTodo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// state</span></span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState(<span class="string">''</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// handlers</span></span><br><span class="line">  <span class="keyword">const</span> onChange = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    setValue(e.target.value);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 省略添加 Todo 逻辑</span></span><br><span class="line">  <span class="keyword">const</span> add = <span class="keyword">async</span> () =&gt; &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=&#123;styles[<span class="string">'page-add-todo'</span>]&#125;&gt;</span><br><span class="line">      &lt;div className=&#123;styles[<span class="string">'add-todo'</span>]&#125;&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          className=&#123;styles[<span class="string">'add-todo-input'</span>]&#125;</span><br><span class="line">          placeholder=<span class="string">"What needs to be done?"</span></span><br><span class="line">          value=&#123;value&#125;</span><br><span class="line">          onChange=&#123;() =&gt; &#123;&#125;&#125;</span><br><span class="line">          onInput=&#123;onChange&#125; /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">      &lt;div className=&#123;styles['todo-footer']&#125;&gt;</span></span><br><span class="line"><span class="regexp">        &lt;AddButton text="Add Todo" onClickMe=&#123;add&#125;/</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> AddTodo;</span><br></pre></td></tr></table></figure>
<p><strong>添加样式</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">// src/pages/add-todo/index.module.scss</span><br><span class="line"><span class="selector-tag">page</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#323239</span>;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">"pingFang SC"</span> <span class="string">"pingFang"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.page-add-todo</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">"pingFang SC"</span> <span class="string">"pingFang"</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">750</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.add-todo</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">flex-grow</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.add-todo-input</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">50</span>rpx;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">100</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">background</span>: none;</span><br><span class="line">  <span class="attribute">border</span>:none;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#DFDFDF</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#0EFFD6</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.todo-footer</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">50</span>rpx <span class="number">0</span> <span class="number">100</span>rpx;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">48</span>rpx;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">200</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>配置路由</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"routes"</span>: [</span><br><span class="line">  	&#123;</span><br><span class="line">      <span class="attr">"path"</span>: <span class="string">"/add-todo"</span>,</span><br><span class="line">      <span class="attr">"source"</span>: <span class="string">"pages/add-todo/index"</span></span><br><span class="line">    &#125;，</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"path"</span>: <span class="string">"/todos"</span>,</span><br><span class="line">      <span class="attr">"source"</span>: <span class="string">"pages/todos/index"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>微信小程序开发者工具中执行自定义编译</strong></p>
<ul>
<li>添加编译模式</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/2070295/1598962397413-735fe7cc-aa62-4f6d-a057-2e684d6cd649.png#align=left&display=inline&height=1027&margin=%5Bobject%20Object%5D&name=mp3.png&originHeight=1027&originWidth=1916&size=190538&status=done&style=none&width=1916" alt="mp3.png"></p>
<ul>
<li>配置启动页面为 pages/add-todo/index</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/2070295/1598962502120-9a9a2d4f-b951-479d-8652-477896eead25.png#align=left&display=inline&height=1023&margin=%5Bobject%20Object%5D&name=mp4.png&originHeight=1023&originWidth=1920&size=183598&status=done&style=none&width=1920" alt="mp4.png"><br>编译后可看到添加 Todo 页面效果<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2070295/1598962525365-97c4d6f9-d180-4bc8-bda7-f88518ac119d.png#align=left&display=inline&height=358&margin=%5Bobject%20Object%5D&name=image.png&originHeight=715&originWidth=397&size=25057&status=done&style=none&width=198.5" alt="image.png">)<img src="https://cdn.nlark.com/yuque/0/2020/png/2070295/1598962542690-911bb7a4-0ad6-4e75-9de7-a26687f3559a.png#align=left&display=inline&height=357&margin=%5Bobject%20Object%5D&name=image.png&originHeight=714&originWidth=403&size=21665&status=done&style=none&width=201.5" alt="image.png"><br><strong>此时的目录结构为：</strong></p>
<blockquote>
<p>原有 Logo 组件及 Home 页面未使用可删除。</p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── public</span><br><span class="line">│   └── index.html</span><br><span class="line">├── src</span><br><span class="line">│   ├── components</span><br><span class="line">│   │   └── add-button     // 新增组件 add-button</span><br><span class="line">│   ├── pages</span><br><span class="line">│   │   ├── add-todo       // 新增页面 add-todo</span><br><span class="line">│   │   └── todos          // 新增页面 todos</span><br><span class="line">│   ├── public</span><br><span class="line">│   │   └── logo.svg       // 新增 logo 图片</span><br><span class="line">│   ├── app.js</span><br><span class="line">│   └── app.json</span><br><span class="line">├── .eslintrc.js</span><br><span class="line">├── .gitignore</span><br><span class="line">├── README.md</span><br><span class="line">├── build.json</span><br><span class="line">├── mini.project.json</span><br><span class="line">├── package-lock.json</span><br><span class="line">├── package.json</span><br><span class="line">└── tsconfig.json</span><br></pre></td></tr></table></figure>
<h3 id="项目配置"><a href="#项目配置" class="headerlink" title="项目配置"></a>项目配置</h3><p>与编写 Web 应用不同的是，需要为小程序增加一些配置。如页面路由、tabBar、页面标题等小程序特有属性。</p>
<p>本程序配置如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// app.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"routes"</span>: [ // 页面路由</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"path"</span>: <span class="string">"/todos"</span>,</span><br><span class="line">      <span class="attr">"source"</span>: <span class="string">"pages/todos/index"</span> // React 组件</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"path"</span>: <span class="string">"/add-todo"</span>,</span><br><span class="line">      <span class="attr">"source"</span>: <span class="string">"pages/add-todo/index"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  "window": &#123; // 页面标题、颜色</span><br><span class="line">    "title": "Todo App",</span><br><span class="line">    "titleBarColor": "#323239"</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可看到头部颜色及标题发生变化<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2070295/1598963028284-83c512f9-1fb0-4c72-b3c0-b79aa4c84006.png#align=left&display=inline&height=715&margin=%5Bobject%20Object%5D&name=mp-window.png&originHeight=715&originWidth=850&size=61654&status=done&style=none&width=850" alt="mp-window.png"></p>
<h3 id="数据请求"><a href="#数据请求" class="headerlink" title="数据请求"></a>数据请求</h3><p>通过与后台 API 接口交互将 Todos 同步到远程数据库中。需要用到 universal-request，该库对数据请求进行了封装，使得用户无需关心 web端、微信小程序、支付宝小程序等多平台差异。一套代码、多处运行。</p>
<h4 id="以获取某用户的-Todos-为例"><a href="#以获取某用户的-Todos-为例" class="headerlink" title="以获取某用户的 Todos 为例"></a>以获取某用户的 Todos 为例</h4><blockquote>
<p>相关接口见后文服务端</p>
</blockquote>
<p>安装 universal-request</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install universal-request</span><br></pre></td></tr></table></figure>
<p>定义数据请求 service</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/services/todos.js</span></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">'universal-request'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 此处为 mock 接口，仅包含查询固定 todos 列表。其他功能如对小程序的增删改查需要服务端</span></span><br><span class="line"><span class="keyword">const</span> URL_PREFIX = <span class="string">'https://easy-mock.bookset.io/mock/5f4f05642ff5d50508b3d21b/todos_mock'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 根据用户 openId 获取对应 todo 列表</span></span><br><span class="line">  <span class="keyword">async</span> list (&#123; openId &#125;) &#123;</span><br><span class="line">      <span class="keyword">let</span> todos = [];</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="comment">// openId 未使用，可随意填写</span></span><br><span class="line">          <span class="keyword">const</span> URL = <span class="string">`<span class="subst">$&#123;URL_PREFIX&#125;</span>/api/mp/todos?openId=<span class="subst">$&#123;openId&#125;</span>`</span>;</span><br><span class="line">          <span class="keyword">const</span> res = <span class="keyword">await</span> request(&#123;</span><br><span class="line">              url: URL</span><br><span class="line">          &#125;);</span><br><span class="line">          todos = res.data.data.todos;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">          <span class="built_in">console</span>.error(err);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> todos;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Todos 组件中调用该数据请求 service，移除默认 Todos</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// src/pages/todos/index.jsx</span><br><span class="line"><span class="addition">+ import todosService from '@/services/todos'; // 引入 todos service</span></span><br><span class="line"></span><br><span class="line">const Todos = () =&gt; &#123;</span><br><span class="line">  // ...</span><br><span class="line">  // lifecycle function</span><br><span class="line">  // usePageShow 函数修改如下</span><br><span class="line">  usePageShow(async () =&gt; &#123;</span><br><span class="line">    // 通过数据请求获取 Todos 数据</span><br><span class="line">    const todos = await todosService.list(1); // 1 为 openId，暂时未使用可随意填写</span><br><span class="line">    setTodos(todos);</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    // 渲染 todos</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>编译</p>
<blockquote>
<p>注意应在微信开发者工具中开启<strong>不校验合法域名</strong></p>
</blockquote>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/2070295/1599028238912-aa9c1d35-bdfd-4a63-8ff2-21bcfd95a90e.png#align=left&display=inline&height=1028&margin=%5Bobject%20Object%5D&name=mp5.png&originHeight=1028&originWidth=1913&size=181778&status=done&style=none&width=1913" alt="mp5.png"><br>执行编译后可得<br><img src="https://cdn.nlark.com/yuque/0/2020/png/2070295/1599028284047-baa3a7c1-4ffd-4b76-90d1-06ae6d034c71.png#align=left&display=inline&height=713&margin=%5Bobject%20Object%5D&name=image.png&originHeight=713&originWidth=401&size=44389&status=done&style=none&width=401" alt="image.png"><br>对于 Todos 列表的增删改查操作需要服务端的支持，此处仅使用 Mock 接口验证数据请求。真实请求逻辑可在服务端篇查看。</p>
<h3 id="数据存储"><a href="#数据存储" class="headerlink" title="数据存储"></a>数据存储</h3><p>数据请求小节介绍了如何发起数据请求，但数据请求需要相应的服务端，服务端未完成的情况下，Todo 小程序无法完成 Todo 的增删改查。</p>
<p>本小节使用微信所提供的数据存储服务，将 Todos 持久化，实现 Todo 的增删改查。</p>
<ul>
<li><p>新建数据存储 service</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> storageKey = &#123;</span><br><span class="line">  todos: <span class="string">'todos'</span>,</span><br><span class="line">  userInfo: <span class="string">'userInfo'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取存储的 Todos</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getStoredTodos</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> todos;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// eslint-disable-next-line</span></span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> wx.getStorage(&#123;</span><br><span class="line">      key: storageKey.todos</span><br><span class="line">    &#125;);</span><br><span class="line">    todos = res.data.todos;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> todos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 存储 Todos</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">storeTodos</span> (<span class="params">todos</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// eslint-disable-next-line</span></span><br><span class="line">  <span class="keyword">await</span> wx.setStorage(&#123;</span><br><span class="line">    key: storageKey.todos,</span><br><span class="line">    data: &#123;</span><br><span class="line">      todos</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取存储的 userInfo</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getUserInfo</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> userInfo;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// eslint-disable-next-line</span></span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> wx.getStorage(&#123;</span><br><span class="line">      key: storageKey.userInfo</span><br><span class="line">    &#125;);</span><br><span class="line">    userInfo = res.data.userInfo;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> userInfo;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 存储 userInfo</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">setUserInfo</span> (<span class="params">userInfo</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// eslint-disable-next-line</span></span><br><span class="line">  <span class="keyword">await</span> wx.setStorage(&#123;</span><br><span class="line">    key: storageKey.userInfo,</span><br><span class="line">    data: &#123;</span><br><span class="line">      userInfo</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  todos: &#123;</span><br><span class="line">    <span class="keyword">get</span>: getStoredTodos,</span><br><span class="line">    <span class="keyword">set</span>: storeTodos</span><br><span class="line">  &#125;,</span><br><span class="line">  userInfo: &#123;</span><br><span class="line">    <span class="keyword">get</span>: getUserInfo,</span><br><span class="line">    <span class="keyword">set</span>: setUserInfo</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>todos 组件和 add-todo 组件添加逻辑</p>
</li>
</ul>
<p>todos 组件：</p>
<ul>
<li>增加获取用户信息函数 getUserInfo</li>
<li>增加初始化 Todos 函数：initTodos</li>
<li>增加添加 Todo 函数：addTodo</li>
<li>增加删除 Todo 函数：delTodo</li>
<li>修改编辑 Todo 函数：onTodoChange<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/pages/todos/index.jsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; usePageShow &#125; <span class="keyword">from</span> <span class="string">'ice'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入 storage service</span></span><br><span class="line"><span class="keyword">import</span> storageService <span class="keyword">from</span> <span class="string">'@/services/storage'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> AddButton <span class="keyword">from</span> <span class="string">'@/components/add-button'</span>;</span><br><span class="line"><span class="keyword">import</span> logo <span class="keyword">from</span> <span class="string">'@/public/logo.svg'</span>;</span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">'./index.module.scss'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Todos = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// state</span></span><br><span class="line">  <span class="keyword">const</span> [userInfo, setUserInfo] = useState(&#123;&#125;);</span><br><span class="line">  <span class="keyword">const</span> [todos, setTodos] = useState([]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// handlers</span></span><br><span class="line">  <span class="comment">// user</span></span><br><span class="line">  <span class="keyword">const</span> getUserInfo = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// eslint-disable-next-line</span></span><br><span class="line">    <span class="keyword">const</span> storedUserInfo = <span class="keyword">await</span> storageService.userInfo.get();</span><br><span class="line">    <span class="comment">// eslint-disable-next-line</span></span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> wx.getUserInfo(); <span class="comment">// 获取用户信息</span></span><br><span class="line">    <span class="keyword">const</span> userInfo = res.userInfo;</span><br><span class="line"></span><br><span class="line">    setUserInfo(userInfo);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> storageService.userInfo.set(userInfo);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// todos</span></span><br><span class="line">  <span class="comment">// 添加 Todo</span></span><br><span class="line">  <span class="keyword">const</span> addTodo = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    wx.redirectTo(&#123;</span><br><span class="line">      url: <span class="string">'/pages/add-todo/index'</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 修改 Todo 完成状态</span></span><br><span class="line">  <span class="keyword">const</span> onTodoChange = <span class="keyword">async</span> id =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> changedContent = &#123;&#125;;</span><br><span class="line">    <span class="keyword">const</span> changedTodos = todos.map(<span class="function"><span class="params">todo</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="attr">id</span>: curId &#125; = todo;</span><br><span class="line">      <span class="keyword">const</span> &#123; completed &#125; = todo.content;</span><br><span class="line">      <span class="keyword">if</span> (id === curId) &#123;</span><br><span class="line">        changedContent = &#123;</span><br><span class="line">          ...todo.content,</span><br><span class="line">          completed: id === curId ? !completed : completed</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...todo,</span><br><span class="line">        content: &#123;</span><br><span class="line">          ...todo.content,</span><br><span class="line">          completed: id === curId ? !completed : completed</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    setTodos(changedTodos);</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">await</span> storageService.todos.set(changedTodos);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 删除 Todo</span></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">delTodo</span> (<span class="params">id</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> changedTodos = todos.filter(<span class="function"><span class="params">todo</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="attr">id</span>: curId &#125; = todo;</span><br><span class="line">      <span class="keyword">return</span> id !== curId;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    setTodos(changedTodos);</span><br><span class="line">    <span class="keyword">await</span> storageService.todos.set(changedTodos);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 初始化 Todos</span></span><br><span class="line">  <span class="keyword">const</span> initTodos = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> storedTodos = <span class="keyword">await</span> storageService.todos.get();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> mergedTodos = storedTodos || [];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(storedTodos, mergedTodos);</span><br><span class="line"></span><br><span class="line">    setTodos(mergedTodos);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> storageService.todos.set(mergedTodos);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// lifecyle function</span></span><br><span class="line">  usePageShow(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'page show'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// eslint-disable-next-line</span></span><br><span class="line">    <span class="keyword">const</span> storedUserInfo = <span class="keyword">await</span> storageService.userInfo.get();</span><br><span class="line">    setUserInfo(storedUserInfo || &#123;&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> initTodos();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=&#123;styles[<span class="string">'page-todos'</span>]&#125;&gt;</span><br><span class="line">      &lt;div className=&#123;styles.user&#125;&gt;</span><br><span class="line">        &lt;button type=<span class="string">'button'</span> open-type=<span class="string">"getUserInfo"</span> onClick=&#123;getUserInfo&#125; className=&#123;styles[<span class="string">'login-button'</span>]&#125; &gt;</span><br><span class="line">          &lt;div style=&#123;&#123;<span class="attr">display</span>: <span class="string">'flex'</span>, <span class="attr">flexDirection</span>: <span class="string">'column'</span>&#125;&#125;&gt;</span><br><span class="line">            &lt;img className=&#123;styles.avatar&#125; src=&#123;userInfo.avatarUrl ? userInfo.avatarUrl : logo&#125; alt=<span class="string">"用户头像"</span> /&gt;</span><br><span class="line">            &lt;span className=&#123;styles.nickname&#125;&gt;&#123;userInfo.nickName ? <span class="string">`<span class="subst">$&#123;userInfo.nickName&#125;</span>'s`</span> : <span class="string">'My'</span> &#125; Todo List&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>div&gt;</span><br><span class="line">        &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;div className=&#123;styles[<span class="string">'todo-items'</span>]&#125;&gt;</span><br><span class="line">        &lt;div className=&#123;styles[<span class="string">'todo-items-group'</span>]&#125;&gt;</span><br><span class="line">          &#123;</span><br><span class="line">            todos.map(<span class="function"><span class="params">todo</span> =&gt;</span> (</span><br><span class="line">              &lt;div style=&#123;&#123;<span class="attr">position</span>: <span class="string">'relative'</span>&#125;&#125; key=&#123;todo.id&#125;&gt;</span><br><span class="line">                &lt;div</span><br><span class="line">                  className=&#123;<span class="string">`<span class="subst">$&#123;styles[<span class="string">'todo-item'</span>]&#125;</span> <span class="subst">$&#123;todo.content.completed ? styles.checked : <span class="string">''</span>&#125;</span>`</span>&#125;</span><br><span class="line">                  onClick=&#123;() =&gt; onTodoChange(todo.id)&#125;</span><br><span class="line">                &gt;</span><br><span class="line">                  &lt;checkbox className=&#123;styles[<span class="string">'todo-item-checkbox'</span>]&#125; checked=&#123;todo.content.completed&#125; /&gt;</span><br><span class="line">                  &lt;span className=&#123;styles[<span class="string">'todo-item-text'</span>]&#125;&gt;&#123;todo.content.text&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">                &lt;/</span>div&gt;</span><br><span class="line">                &lt;div</span><br><span class="line">                  className=&#123;styles[<span class="string">'close-wrapper'</span>]&#125;</span><br><span class="line">                  onClick=&#123;() =&gt; delTodo(todo.id)&#125;&gt;</span><br><span class="line">                  &lt;div className=&#123;styles.close&#125;/&gt;</span><br><span class="line">                &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">              &lt;/</span>div&gt;</span><br><span class="line">            ))</span><br><span class="line">          &#125;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div className=&#123;styles[<span class="string">'todo-footer'</span>]&#125;&gt;</span><br><span class="line">        &lt;AddButton text=<span class="string">"Add Todo"</span> onClickMe=&#123;addTodo&#125; /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Todos;</span><br></pre></td></tr></table></figure>
add-todo 组件</li>
</ul>
<ul>
<li>修改添加 Todo 函数：add<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/pages/add-todo/index.jsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入 storage service</span></span><br><span class="line"><span class="keyword">import</span> storageService <span class="keyword">from</span> <span class="string">'@/services/storage'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> AddButton <span class="keyword">from</span> <span class="string">'@/components/add-button'</span>;</span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">'./index.module.scss'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> AddTodo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// state</span></span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState(<span class="string">''</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// handlers</span></span><br><span class="line">  <span class="comment">// 输入监听函数</span></span><br><span class="line">  <span class="keyword">const</span> onChange = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    setValue(e.target.value);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 添加 Todo</span></span><br><span class="line">  <span class="keyword">const</span> add = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> curTodos = <span class="keyword">await</span> storageService.todos.get();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> todo = &#123;</span><br><span class="line">      id: (<span class="keyword">new</span> <span class="built_in">Date</span>()).getTime(),</span><br><span class="line">      content: &#123;</span><br><span class="line">        text: value,</span><br><span class="line">        completed: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> newTodos = curTodos.concat(todo);</span><br><span class="line">    storageService.todos.set(newTodos);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// eslint-disable-next-line</span></span><br><span class="line">    wx.redirectTo(&#123;</span><br><span class="line">      url: <span class="string">'/pages/todos/index'</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=&#123;styles[<span class="string">'page-add-todo'</span>]&#125;&gt;</span><br><span class="line">      &lt;div className=&#123;styles[<span class="string">'add-todo'</span>]&#125;&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          className=&#123;styles[<span class="string">'add-todo-input'</span>]&#125;</span><br><span class="line">          placeholder=<span class="string">"What needs to be done?"</span></span><br><span class="line">          value=&#123;value&#125;</span><br><span class="line">          onChange=&#123;() =&gt; &#123;&#125;&#125;</span><br><span class="line">          onInput=&#123;onChange&#125; /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">      &lt;div className=&#123;styles['todo-footer']&#125;&gt;</span></span><br><span class="line"><span class="regexp">        &lt;AddButton text="Add Todo" onClickMe=&#123;add&#125;/</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> AddTodo;</span><br></pre></td></tr></table></figure>
执行编译，运行项目<br>此时，本程序可获取用户基本信息，增加 Todo。</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/2070295/1599037234361-0165b321-d833-4de3-9ac4-75924cc989b5.png#align=left&display=inline&height=1559&margin=%5Bobject%20Object%5D&name=mp11.png&originHeight=1559&originWidth=1276&size=112351&status=done&style=none&width=1276" alt="mp11.png"></p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>至此，小程序部分已基本完成。</p>
<p>本文介绍了使用 icejs开发小程序的基本流程，包括使用组件 UI 的编写；路由及其它小程序相关的项目配置；发起数据请求；调用微信小程序 API 获取用户信息和存储数据。</p>
<p>小程序同步 Todo 列表至服务端需要服务端的配合，故将该功能在服务端篇进行实现。</p>
<p>小程序代码见 <a href="https://github.com/ice-lab/miniprogram-materials/tree/master/scaffolds/todos" target="_blank" rel="noopener">miniprogram-materials/scaffolds/todos</a>，可结合服务端 <a href="https://github.com/ice-lab/icejs-miniapp-admin/tree/master/server" target="_blank" rel="noopener">icejs-miniapp-admin/server</a> 一起运行查看效果。</p>
<h2 id="推荐阅读"><a href="#推荐阅读" class="headerlink" title="推荐阅读"></a>推荐阅读</h2><ul>
<li><a href="https://ice.work/" target="_blank" rel="noopener">飞冰</a></li>
<li><a href="https://ice.work/docs/miniprogram/start" target="_blank" rel="noopener">icejs 小程序官方文档</a></li>
<li><a href="https://github.com/ice-lab/miniprogram-materials/tree/master/scaffolds/todos" target="_blank" rel="noopener">Todos 小程序代码</a></li>
<li><a href="https://github.com/ice-lab/icejs-miniapp-admin/client" target="_blank" rel="noopener">Todos 后台管理系统代码</a></li>
<li><a href="https://github.com/ice-lab/icejs-miniapp-admin/tree/master/server" target="_blank" rel="noopener">Todos 服务端代码</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/2020/10/12/icejs-todos-management/" class="prev">PREV</a><a href="/2020/10/12/cheatsheet-emoji/" class="next">NEXT</a></div><div class="copyright"><p>© 2017 - 2020 <a href="https://lancezhu.github.io">lancezhu</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script src="//cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script><script src="/js/copy-codeblock.js"></script></body></html>